{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Die Fräse und der Data Scientist\"\nauthor: \"Ein Industrie 4.0 Märchen\"\ndate: \" Eugene Harschack\"\noutput: ioslides_presentation\n---\n\n\n\n## Das Statistikermärchen\n\nLiebe Leser,</p>\ndies ist ein Märchen, welches wohl eines der ersten seiner Art ist. Nicht nur handelt es von Data Science, was für Märchen ein eher ungewöhnliches Thema ist, es ist dabei vollständig in RMarkdown geschrieben. </p>\nDarum sollen Sie sich nicht darüber wundern, wenn Sie feststellen, dass sich die Zahlen, wie von magischer Hand, geändert haben. \n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE)\nlibrary(dplyr)\nlibrary(pROC)\n```\n\n```{r time, include=TRUE}\nprint(\"Dieses Märchen wurde erstellt am:\")\nprint(Sys.time())\n```\n\n\n\n## Vor langer langer Zeit, in einem fernen Industrie-Land ...\n... stand in einer kleinen Firma die gute alte Fräse.\nUnd in dieser Firma arbeiteten:\n\n- ein Manager,\n\n- ein Maschinenschlosser,\n\n- und ein Data Scientist Scientist.\n\nWas aber eigentlich nichts zur Sache tut, denn in diesem Märchen geht es um die Variablen\n**x**, **y** und **z**\n\n\n\n## x\n\n- **x** war der Wasserdruck zur Kühlung der Fräse. Fiel die Anzeige unter 5, lief die Fräse heiß und der Rohling nicht mehr zu retten.\n<center>![](http://harschack.de/downloads/maerchen/anzeige_klein.png)\n\n\n\n\n\n\n## ...\n\n```{r chunk1, echo = FALSE}\nsim_widget_data <- function(noise=10){\n  N=2000\n  x_temp <- rnorm(N,mean = 10,sd = 5)\n  x<-x_temp\n  x[which(x_temp <0)]<-x_temp[which(x_temp <0)]*(-1)\n  x[which(x_temp >20)]<-x_temp[which(x_temp >20)]-20\n  \n  y_temp <-  - 10*x + 200 + rnorm(N, sd=noise)\n  y<-y_temp\n  y[which(y_temp <0)]<-y_temp[which(y_temp <0)]*-1\n  z<-runif(N)\n  \n  bad_widget <- factor(y > 150) #original\n  data.frame(x, y,z, bad_widget)\n}\nwidget_data <- sim_widget_data(0)\n```\n\n\n```{r chunk2, echo = TRUE}\nhist(widget_data$x, breaks=20,col=c(rep(\"red\",5),rep(\"grey50\",15)))\n```\n\n\n## Y\n- **y** war die abhängige Variable. Sie war die tatsächliche Temperatur der Fräse\n```{r chunk3, echo = FALSE}\nplot(widget_data$x, widget_data$y, col=widget_data$bad_widget, pch=20, \n     main=\"Ausfall bei 150°\")\nabline(h=150, col=\"red\", lty=2)\nabline(v=5, col=\"red\", lty=2)\n```\n\n\n## Die Korrelation\nDer Zusammenhang zwischen Wasserdruck und Temperatur ist in Vergessenheit geraten, aber angesichts der hohen Korrelation zweifelte niemand an der Zuverlässigkeit der Anzeige.\n```{r chunk4, echo = TRUE}\ncor(widget_data$x, widget_data$y)\n```\n\n## Z\n- **z** war eine weitere Anzeige. Was niemand mehr wusste war, dass man hier nur der Wasserstand im Spülkasten des goldenen Throns ablesen konnte.\n![](http://harschack.de/downloads/maerchen/thron.jpg)\n\n## Dieser Wasserstand...\n... hatte nichts, aber auch gar nichts, mit der Temperatur unserer Fräse zu tun.\n```{r chunk6, echo = TRUE}\nplot(widget_data$z, widget_data$y, col=widget_data$bad_widget, pch=20)\n```\n\n\n## Aber dann wurde die Genauigkeit schlechter (noise=10)\n```{r chunk7, echo = FALSE}\nwidget_data <- sim_widget_data(10)\nplot(widget_data$x, widget_data$y, col=widget_data$bad_widget, pch=20)\nabline(h=150, col=\"red\", lty=2)\nabline(v=5, col=\"red\", lty=2)\nabline(v=max(widget_data$x[which(widget_data$bad_widget==T)]), col=\"orange\", lty=2, lwd=2)\n```\n\n## ... und schlechter ... (noise=20)\n```{r chunk9, echo = FALSE}\nwidget_data <- sim_widget_data(20)\nplot(widget_data$x, widget_data$y, col=widget_data$bad_widget, pch=20)\nabline(h=150, col=\"red\", lty=2)\nabline(v=5, col=\"red\", lty=2)\nabline(v=max(widget_data$x[which(widget_data$bad_widget==T)]), col=\"orange\", lty=2, lwd=2)\n```\n\n\n## ... und noch schlechter ... (noise=30)\n```{r chunk11, echo = FALSE}\nwidget_data <- sim_widget_data(30)\nplot(widget_data$x, widget_data$y, col=widget_data$bad_widget, pch=20)\nabline(h=150, col=\"red\", lty=2)\nabline(v=5, col=\"red\", lty=2)\nabline(v=max(widget_data$x[which(widget_data$bad_widget==T)]), col=\"orange\", lty=2, lwd=2)\n```\n\n\n## So schlecht... (noise=100)\n... dass kaum noch jemand der alten Anzeige Glauben schenken wollte.\n```{r chunk13, echo = FALSE}\nwidget_data <- sim_widget_data(100)\nplot(widget_data$x, widget_data$y, col=widget_data$bad_widget, pch=20)\nabline(h=150, col=\"red\", lty=2)\nabline(v=5, col=\"red\", lty=2)\nabline(v=max(widget_data$x[which(widget_data$bad_widget==T)]), col=\"orange\", lty=2, lwd=2)\n```\n\n\n## Eines Abends\nNach ein paar Flaschen Ale kamen der Manager und der Schlosser auf die Idee, dass man doch glatt z als Warnsignal für die Fräse verwenden könnte. Wie viel schlechter kann es schon werden?\n```{r chunk14, echo = TRUE}\ncor(widget_data$x, widget_data$y)\ncor(widget_data$z, widget_data$y)\n```\n\n## In Zeiten größter Not kam wie aus dem nichts...\n... der Data Scientist. Er trug eine kleine magische Kiste mit sich. Darin lanweilten sich das  **Model GLM**, ein äußerst **verallgmeinertes** und **lineares Model(l)**, und ein kleiner **Waldscharat**, zufällig wie alle Bewohner des **randomForest**\n\n![Waldscharat](http://harschack.de/downloads/maerchen/waldscharat.png)\n\n\n## Der Data Scientist machte sich ans Werk.\nWie es in seiner Zunft seit jeher Brauch ist, bildete er eine Stichprobe, damit seine Begleiter einen Datensatz zum Training und einen zum Testen erhalten.\n```{r chunk15, echo = TRUE}\ntest_set_idx <- sample(1:nrow(widget_data), \n                       size=floor(nrow(widget_data)/4))\ntest_set <- widget_data[test_set_idx,]\ntrain_set <- widget_data[-test_set_idx,]\n```\n\n## ...\n```{r chunk16, echo = TRUE}\nplot(train_set$x,train_set$y,col=train_set$bad_widget, pch=\"+\")\npoints(test_set$x,test_set$y,col=test_set$bad_widget, pch=1)\n```\n\n## Er ließ das GLM aus der Kiste, ...\n... sofort fing das Model an, wie verrückt, zu trainieren...\n```{r chunk17, echo = TRUE}\nfit_glm_x <- glm(bad_widget ~ x, train_set, family=binomial(link=\"logit\"))\nfit_glm_z <- glm(bad_widget ~ z, train_set, family=binomial(link=\"logit\"))\n```\n\n## ...bis für x und z jeweils ein Modell entstand, um den Ausschuss zu erklären\n```{r chunk18, echo = FALSE}\npred_glm_lx <- predict(fit_glm_x, test_set, type=\"link\")\npred_glm_lz <- predict(fit_glm_z, test_set, type=\"link\")\n```\n\n```{r chunk18a, echo = TRUE}\npred_glm_rx <- predict(fit_glm_x, test_set, type=\"response\")\npred_glm_rz <- predict(fit_glm_z, test_set, type=\"response\")\n\n```\n\n## Der Schlosser...\nkonnte dem bunten Treiben nichts abgewinnen und verließ sich weiter auf seinen Erfahrungswert von 5\n\n```{r chunk19c, echo = FALSE}\ntest_set$int=NA\ntest_set$int[which(test_set$x<5)]<-1\ntest_set$int[which(test_set$x>=5)]<-0\ntab_int<-table(test_set$int,test_set$bad_widget)\nprint(tab_int)\n```\n\nDamit in\n```{r chunk19d, echo = FALSE}\nprint(sum(diag(tab_int))/sum(tab_int)*100)\n\n```\nProzent richtig\n\n\n## Das Modell kam auf...\n```{r chunk19a, echo = FALSE}\nglm_rx_cut<-cut(pred_glm_rx,breaks = c(-Inf, 0.5, Inf), labels=c(0,1))%>%\n  as.character()%>%\n  as.integer()%>%\n  as.logical()\ntab_glm_x<-table(glm_rx_cut,test_set$bad_widget)\n```\n```{r chunk19b, echo = FALSE}\nprint(tab_glm_x)\n\n```\nalso in\n```{r chunk19e, echo = FALSE}\nprint(sum(diag(tab_glm_x))/sum(tab_glm_x)*100)\n```\nProzent richtig\n\n## X ist besser\nSagte der Schlosser. Schließlich liegt es in\n```{r chunk20, echo = FALSE}\n\n```\nProzent richtig.\n\n\n\n## Was ist denn mit z passiert?\n```{r chunk21a, echo = FALSE}\nglm_rz_cut<-cut(pred_glm_rz,breaks = c(-Inf, 0.5, Inf), labels=c(0,1))%>%\n  as.character()%>%\n  as.integer()%>%\n  as.logical()\ntab_glm_z<-table(glm_rz_cut,test_set$bad_widget)\n```\n\n```{r chunk21b, echo = TRUE}\ntab_glm_z\n\n```\n\n## Können wir nicht trotzdem z verwenden?\n-fragte der Manager. Schließlich war der Sensor teuer und\n```{r chunk22, echo = FALSE}\n(sum(diag(tab_glm_z))/sum(tab_glm_z))*100\n```\nProzent Genauigkeit sind doch gar nicht so schlecht.\n\n-**Nein**, antwortete der Data Scientist, kreidebleich, mit dem Ausdruck von blankem Entsetzten im Gesicht.\n\n## Zum Glück kam zufällig eine ROC-Kurve vorbei\nSie sah sich an, was das verallgemeinerte lineare Modell aus x und z genacht hatte und konnte so einige Zweifel klären.\n```{r chunk23, echo = FALSE}\nroc_glm_x<-roc(test_set$bad_widget, pred_glm_rx, direction=\"<\")\nroc_glm_z<-roc(test_set$bad_widget, pred_glm_rz, direction=\"<\")\nroc_int<-roc(test_set$bad_widget, test_set$int, direction=\"<\")\n\n\nplot(roc_glm_x, col=\"red\", lwd=2)\nlines(roc_glm_z, col=\"magenta\",lwd=2)\nlines(roc_int, col=\"blue\", lwd=2)\n```\n\n\n## Laßt das mal den Papa machen, \nmischte sich der Zufällige Waldscharat ein, der bis dahin still und fast regungslos in der Ecke gesessen hatte.\n\n```{r chunk24, echo = FALSE}\n\n```",
    "created" : 1501749376743.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2283564410",
    "id" : "5C26CA2C",
    "lastKnownWriteTime" : 1502901909,
    "last_content_update" : 1502901909350,
    "path" : "C:/Users/User/Dropbox/Work/Statistikmaerchen/Statistikmaerchen.Rmd",
    "project_path" : "Statistikmaerchen.Rmd",
    "properties" : {
        "last_setup_crc32" : "",
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}